!function(e){function t(t){for(var r,s,i=t[0],l=t[1],c=t[2],u=0,d=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&d.push(n[s][0]),n[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(f&&f(t);d.length;)d.shift()();return o.push.apply(o,c||[]),a()}function a(){for(var e,t=0;t<o.length;t++){for(var a=o[t],r=!0,i=1;i<a.length;i++){var l=a[i];0!==n[l]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=a[0]))}return e}var r={},n={0:0},o=[];function s(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=r,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(a,r,function(t){return e[t]}.bind(null,r));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var f=l;o.push([37,1]),a()}({33:function(e,t){},34:function(e,t){},35:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){"use strict";a.r(t);var r=a(7),n=a.n(r),o=a(2),s=a(0),i=a.n(s),l=a(3),c=a(8),f=a.n(c),u=a(9),d=a.n(u);function p(e){var t;if((t=e.match(/\/\/.*/))&&(e=e.substr(0,t.index).trim()),t=e.match(/^([A-Z]+):(.+)/i)){t[1];var a=t[1].toUpperCase(),r=t[2];if(["TITLE","SUBTITLE","BPM","WAVE","OFFSET","DEMOSTART","GENRE"].includes(a))return{type:"header",scope:"global",name:a,value:r.trim()};if(["COURSE","LEVEL","BALLOON","SCOREINIT","SCOREDIFF","TTROWBEAT"].includes(a))return{type:"header",scope:"course",name:a,value:r.trim()}}else if(t=e.match(/^#([A-Z]+)(?:\s+(.+))?/i)){t[1];var n=t[1].toUpperCase(),o=t[2]||"";if(["START","END","GOGOSTART","GOGOEND","MEASURE","SCROLL","BPMCHANGE","DELAY","BRANCHSTART","BRANCHEND","SECTION","N","E","M","LEVELHOLD","BMSCROLL","HBSCROLL","BARLINEOFF","BARLINEON","TTBREAK"].includes(n))return{type:"command",name:n,value:o.trim()}}else if(t=e.match(/^([0-9]*,?)$/)){return{type:"data",data:t[1]}}return{type:"unknown",value:e}}function v(e,t){var a={course:"Easy",level:1,balloon:[],scoreInit:100,scoreDiff:100,ttRowBeat:16},r=[],n=4,o=4,s={},i="",l=[],c=!0,f=!1,u=void 0;try{for(var d,p=t[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var v=d.value;if("header"===v.type)switch(v.name){case"COURSE":a.course=v.value;break;case"LEVEL":a.level=parseInt(v.value,10);break;case"BALLOON":var h=v.value.split(/[^0-9]/).filter((function(e){return""!==e})).map((function(e){return parseInt(e,10)}));a.balloon=h;break;case"SCOREINIT":a.scoreInit=parseInt(v.value,10);break;case"SCOREDIFF":a.scoreDiff=parseInt(v.value,10);break;case"TTROWBEAT":a.ttRowBeat=parseInt(v.value,10)}else if("command"===v.type)switch(v.name){case"MEASURE":var g=v.value.match(/(\d+)\/(\d+)/);if(!g)break;n=parseInt(g[1],10),o=parseInt(g[2],10);break;case"GOGOSTART":l.push({name:"gogoStart",position:i.length});break;case"GOGOEND":l.push({name:"gogoEnd",position:i.length});break;case"SCROLL":l.push({name:"scroll",position:i.length,value:parseFloat(v.value)});break;case"BPMCHANGE":l.push({name:"bpm",position:i.length,value:parseFloat(v.value)});break;case"TTBREAK":s.ttBreak=!0}else if("data"===v.type){var b=v.data;if(b.endsWith(",")){var m={length:[n,o],properties:s,data:i+=b.slice(0,-1),events:l};r.push(m),i="",l=[],s={}}else i+=b}}}catch(e){f=!0,u=e}finally{try{c||null==p.return||p.return()}finally{if(f)throw u}}if(r.length){for(var y=!1,k=0;k<r[0].events.length;k++){var x=r[0].events[k];if("bpm"===x.name&&0===x.position){y=!0;break}}y||r[0].events.unshift({name:"bpm",position:0,value:e.bpm})}var E=0;switch(a.course.toLowerCase()){case"easy":case"0":E=0;break;case"normal":case"1":E=1;break;case"hard":case"2":E=2;break;case"oni":case"3":E=3}return{course:E,headers:a,measures:r}}function h(e,t,a,r,n,o,s){e.beginPath(),e.moveTo(t,a),e.lineTo(r,n),e.lineWidth=o,e.strokeStyle=s,e.stroke(),e.closePath()}function g(e,t,a,r,n){e.beginPath(),e.arc(t,a,r,0,2*Math.PI,!1),e.fillStyle=n,e.fill(),e.closePath()}function b(e,t,a,r,n,o){e.fillStyle=o,e.fillRect(t,a,r,n)}function m(e,t,a,r,n,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"middle",i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"center";e.font=n,e.textBaseline=s,e.textAlign=i,e.fillStyle=o,e.fillText(r,t,a)}function y(e,t,a,r,n){m(e,t,a,r,'5px "Pixel 3x5"',n,arguments.length>5&&void 0!==arguments[5]?arguments[5]:"middle",arguments.length>6&&void 0!==arguments[6]?arguments[6]:"center")}var k=18,x=k+32,E=k+16,O=24,S=9,B=function(e){return 64+(x+16)*e},T=function(e){return 24+48*e};function w(e,t){return{x:T(t),y:B(e)+E}}function A(e,t,a,r){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=w(t,a),s=o.x,i=o.y;g(e,s,i,S,"#000"),n?(g(e,s,i,S-1,"#fff"),g(e,s,i,S-2,r)):g(e,s,i,S-1,r)}function C(e,t,a,r){var n=w(t,a),o=n.x,s=n.y;g(e,o,s,S+3,"#000"),g(e,o,s,S+2,"#fff"),g(e,o,s,S,r)}function R(e,t,a,r,n,o,s){var i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"body",l=w(a,r),c=l.x,f=l.y,u=w(n,o),d=u.x,p=u.y,v="gogo"===i,h="bodyBig"===i,g=v?E:S+(h?3:0);f-=g,p-=g;var m=v?k:2*S+(h?6:0);if(a===n){var y=d-c;v?b(e,c,f,y,m,s):(b(e,c,f,y,m,"#000"),b(e,c,f+1,y,m-2,"#fff"),b(e,c,f+2,y,m-4,s))}else{var x=t[a].totalBeat,A=T(x)-c+O;v?b(e,c,f,A,m,s):(b(e,c,f,A,m,"#000"),b(e,c,f+1,A,m-2,"#fff"),b(e,c,f+2,A,m-4,s));for(var C=a+1;C<n;C++){var R=B(C),L=T(t[C].totalBeat)+O;v?b(e,0,R,L,m,s):(b(e,0,R+=E-S-(h?3:0),L,m,"#000"),b(e,0,R+1,L,m-2,"#fff"),b(e,0,R+2,L,m-4,s))}var F=T(o);v?b(e,0,p,F,m,s):(b(e,0,p,F,m,"#000"),b(e,0,p+1,F,m-2,"#fff"),b(e,0,p+2,F,m-4,s))}}function L(e,t,a,r,n,o){A(e,a,r,"#fe4"),A(e,n,o,"#fe4"),R(e,t,a,r,n,o,"#fe4","body")}function F(e,t,a,r,n,o){C(e,a,r,"#fe4"),C(e,n,o,"#fe4"),R(e,t,a,r,n,o,"#fe4","bodyBig")}function I(e,t,a,r,n,o,s){A(e,n,o,"#fb4"),R(e,t,a,r,n,o,"#fb4","body"),A(e,a,r,"#fb4",!1);var i=w(a,r);y(e,i.x,i.y+.5,s.toString(),"#000")}var P=function(e,t){for(var a=e.courses[t],r=a.headers.ttRowBeat,n=[],o=[],s=0,i=0;i<a.measures.length;i++){var l=a.measures[i],c=l.length[0]/l.length[1]*4;(r<s+c||l.properties.ttBreak)&&(n.push({beats:s,measures:o}),o=[],s=0),o.push(l),s+=c}o.length&&n.push({beats:s,measures:o});var f=24+48*r+O,u=64+(x+16)*n.length+8,d=document.createElement("canvas");d.width=f,d.height=u,document.body.appendChild(d);var p=d.getContext("2d");b(p,0,0,f,u,"#cccccc");for(var v=0;v<n.length;v++){var g=n[v],E=g.beats;g.measures;g.totalBeat=E;var S=24+48*E+O,w=B(v);b(p,0,w+k,S,32,"#000"),b(p,0,w+k+2,S,28,"#fff"),b(p,0,w+k+4,S,24,"#999")}m(p,8,8,e.headers.title,"bold 28px sans-serif","#000","top","left");m(p,8,40,["かんたん","ふつう","むずかしい","おに"][a.course]+" "+"★".repeat(a.headers.level)+"☆".repeat(Math.max([5,7,8,10][a.course]-a.headers.level,0)),"bold 20px sans-serif","#000","top","left");for(var P=!1,M=1,N=0;N<n.length;N++)for(var D=n[N].measures,j=0,G=0;G<D.length;G++){var U=D[G],H=U.length[0]/U.length[1]*4;U.rowBeat=j;for(var V=0;V<U.events.length;V++){var W=U.events[V],_=j+H/(U.data.length||1)*W.position;"gogoStart"===W.name?P=[N,_]:"gogoEnd"===W.name&&(R(p,n,P[0],P[1],N,_,"#fbb","gogo"),P=!1)}j+=H}for(var J=0;J<n.length;J++)for(var K=n[J].measures,Z=0,z=B(J),Y=0;Y<K.length;Y++){for(var $=T(Z),q=K[Y],Q=q.length[0]/q.length[1]*4,X=z+k,ee=1;ee<2*q.length[0];ee++){var te=ee/q.length[1]*2,ae=T(Z+te);h(p,ae,X,ae,X+32,2,"#fff"+(ee%2?"4":"8"))}for(var re=0;re<q.events.length;re++){var ne=q.events[re],oe=Q/(q.data.length||1)*ne.position,se=T(Z+oe);"scroll"===ne.name?(h(p,se,z,se,z+x,2,"#444"),y(p,se+2,z+k-13,"HS "+ne.value.toString(),"#f00","bottom","left")):"bpm"===ne.name&&(h(p,se,z,se,z+x,2,"#444"),y(p,se+2,z+k-7,"BPM "+ne.value.toString(),"#00f","bottom","left"))}if(h(p,$,z,$,z+x,2,"#fff"),y(p,$+2,z+k-1,M.toString(),"#000","bottom","left"),M+=1,Z+=Q,Y+1===K.length){var ie=T(Z);h(p,ie,z,ie,z+x,2,"#fff")}}for(var le=0,ce=!1,fe=0;fe<n.length;fe++)for(var ue=n[fe].measures,de=0;de<ue.length;de++)for(var pe=ue[de],ve=pe.data.length;ve>=0;ve--){var he=pe.data.charAt(ve);"7"===he&&(le+=1),"9"===he&&(ce||(ce=1,le+=1)),"8"===he&&ce&&(ce=!1)}if(a.headers.balloon.length<le)throw document.body.removeChild(d),new Error("BALLOON count mismatch");for(var ge=!1,be=!1,me=n.length-1;me>=0;me--)for(var ye=n[me].measures,ke=ye.length-1;ke>=0;ke--)for(var xe=ye[ke],Ee=xe.length[0]/xe.length[1]*4,Oe=xe.data.length;Oe>=0;Oe--){var Se=xe.data.charAt(Oe),Be=xe.rowBeat+Ee/xe.data.length*Oe;if("0"!==Se&&"9"!==Se&&be){be[0];var Te=be[be.length-1],we=a.headers.balloon[le-1];I(p,n,Te[0],Te[1],ge[0],ge[1],we),le-=1,ge=!1,be=!1}switch(Se){case"1":A(p,me,Be,"#f33");break;case"2":A(p,me,Be,"#5cf");break;case"3":C(p,me,Be,"#f33");break;case"4":C(p,me,Be,"#5cf");break;case"5":L(p,n,me,Be,ge[0],ge[1]),ge=!1;break;case"6":F(p,n,me,Be,ge[0],ge[1]),ge=!1;break;case"7":var Ae=a.headers.balloon[le-1];I(p,n,me,Be,ge[0],ge[1],Ae),le-=1,ge=!1;break;case"9":be||(be=[]),be.push([me,Be]);break;case"8":ge=[me,Be]}}return document.body.removeChild(d),d};var M=function(e,t){var a=function(e){for(var t=[],a=[],r=0,n=0,o=!1,s=0;s<e.measures.length;s++){for(var i=e.measures[s],l=i.length[0]/i.length[1]*4,c=0;c<i.events.length;c++){var f=i.events[c],u=l/(i.data.length||1)*f.position;"bpm"===f.name?t.push({type:"bpm",value:f.value,beat:r+u}):"gogoStart"===f.name?t.push({type:"gogoStart",beat:r+u}):"gogoEnd"===f.name&&t.push({type:"gogoEnd",beat:r+u})}for(var d=0;d<i.data.length;d++){var p=i.data.charAt(d),v={type:"",beat:r+l/i.data.length*d};switch(p){case"1":v.type="don";break;case"2":v.type="kat";break;case"3":v.type="donBig";break;case"4":v.type="katBig";break;case"5":v.type="renda";break;case"6":v.type="rendaBig";break;case"7":v.type="balloon",v.count=e.headers.balloon[n++];break;case"9":!1===o&&(v.type="balloon",v.count=e.headers.balloon[n++],o=!0);break;case"8":v.type="end",o&&(o=!1)}v.type&&a.push(v)}r+=l}return function(e,t){for(var a=120,r=0,n=0,o=0,s=0,i=[];s<t.length;){for(var l=e[o],c=t[s];l&&l.beat<=c;){if("bpm"===l.type){var f=l.beat-r;r+=f,n+=60/a*f,a=l.value}l=e[++o]}var u=c-r,d=60/a*u;i.push(n+d),r+=u,n+=d,s++}return i}(t,a.map((function(e){return e.beat}))).forEach((function(e,t){a[t].time=e})),{headers:e.headers,events:t,notes:a}}(e.courses[t]);return{statistics:function(e){for(var t=[0,0,0,0],a=[],r=[],n=0,o=0,s=0,i=!1,l=!1,c=0,f=0,u=0,d=e.events[u],p=0,v=[[0,0,0,0,0],[0,0,0,0,0]],h=[0,0],g=[0,0],b=0,m=["don","kat","donBig","katBig"],y=0;y<e.notes.length;y++){var k=e.notes[y];if(d&&d.beat<=k.beat)do{"gogoStart"===d.type?p=1:"gogoEnd"===d.type&&(p=0),u+=1,d=e.events[u]}while(d&&d.beat<=k.beat);var x=m.indexOf(k.type);if(-1===x)if("renda"!==k.type&&"rendaBig"!==k.type)if("balloon"!==k.type){if("end"===k.type)if(i)a.push(k.time-i),i=!1;else if(l){var E=k.time-l,O=c/E;r.push([E,c]),l=!1,O<=60&&(h[f]+=c-1,g[f]+=1)}}else l=k.time,c=k.count,f=p;else i=k.time;else{0===y&&(n=k.time),o=k.time,t[x]+=1;var S=2===x||3===x,B=(s+=1)<10?0:s<30?1:s<50?2:s<100?3:4;v[p][B]+=S?2:1;var T=e.headers.scoreInit+e.headers.scoreDiff*(s<10?0:s<30?1:s<50?2:s<100?4:8),w=10*Math.floor(T/10);p&&(w=10*Math.floor(1.2*w/10)),S&&(w*=2),b+=w}}return{totalCombo:s,notes:t,length:o-n,rendas:a,balloons:r,score:{score:b,notes:v,balloon:h,balloonPop:g}}}(a),graph:function(e){for(var t=[],a={don:0,kat:0},r=0,n=e.notes[e.notes.length-1].time/100,o=["don","kat","donBig","katBig"],s=0;s<e.notes.length;s++){var i=e.notes[s];if(-1!==o.indexOf(i.type)){for(;(t.length+1)*n<=i.time;){var l=a.don+a.kat;r<l&&(r=l),t.push(a),a={don:0,kat:0}}"don"===i.type||"donBig"===i.type?a.don+=1:"kat"!==i.type&&"katBig"!==i.type||(a.kat+=1)}}for(;t.length<100;)t.push({don:0,kat:0});return{timeframe:n,max:r,data:t}}(a)}},N=(a(35),a(36),i()(".editor-live")),D=i()(".editor-process"),j=i()(".area-editor .input"),G=i()(".area-errors .errors"),U=null,H="",V="preview";function W(e){G.text(e)}function _(){i()(".controls-diff .button.is-active").removeClass("is-active"),i()(".controls-diff .btn-diff-".concat(H)).addClass("is-active"),i()(".controls-page .button.is-active").removeClass("is-active"),i()(".controls-page .btn-page-".concat(V)).addClass("is-active"),i()(".area-pages .page").addClass("is-hidden"),i()(".area-pages .page-".concat(V)).removeClass("is-hidden"),"preview"===V&&""!==H?K():i()("#tja-preview").remove(),"statistics"===V&&function(){if(""===H)return;try{!function(e){var t=e.statistics,a=e.graph;i()(".stat-total-combo").text(t.totalCombo);var r=U.courses[H].headers,o=r.scoreInit,s=r.scoreDiff,c=function(e){return 10*Math.floor(e/10)},f=[0,1,2,4,8].map((function(e){return c(o+s*e)})),u=f.map((function(e){return c(1.2*e)})),d=f.map((function(e,a){return t.score.notes[0][a]*e})).reduce((function(e,t){return e+t}),0)+u.map((function(e,a){return t.score.notes[1][a]*e})).reduce((function(e,t){return e+t}),0)+300*t.score.balloon[0]+360*t.score.balloon[1]+5e3*t.score.balloonPop[0]+6e3*t.score.balloonPop[1]+1e4*Math.floor(t.totalCombo/100);t.rendas.length?i()(".stat-max-score").text("".concat(d,"点 + 連打")):i()(".stat-max-score").text("".concat(d,"点"));i()(".stat-don-small").text(t.notes[0]),i()(".stat-don-big").text(t.notes[2]),i()(".stat-kat-small").text(t.notes[1]),i()(".stat-kat-big").text(t.notes[3]);var p=t.notes[0]+t.notes[2],v=t.notes[1]+t.notes[3];i()(".stat-don").text(p),i()(".stat-kat").text(v);var h=p/t.totalCombo*100,g=100-h;i()(".stat-don-ratio").text(h.toFixed(2)+"%"),i()(".stat-kat-ratio").text(g.toFixed(2)+"%"),i()(".stat-density").text((t.totalCombo/t.length).toFixed(3)),i()(".stat-length").text(t.length.toFixed(2)),i()(".stat-renda").text(t.rendas.map((function(e){return e.toFixed(3)+"秒"})).join(" + ")),i()(".stat-renda-total").text(t.rendas.reduce((function(e,t){return e+t}),0).toFixed(3)),i()(".stat-balloon").html(t.balloons.map((function(e){return"".concat(e[0].toFixed(3),"秒 / ").concat(e[1],"打 (").concat((e[1]/e[0]).toFixed(3),"打/秒)")})).join("<br>"));var b=l.b().rangeRound([0,600]),m=l.c().rangeRound([200,0]),y=5*Math.ceil(a.max/5),k=n()(Array(y/5+1).keys()).map((function(e){return 5*e}));i()(".stat-graph").empty();var x=l.d(".stat-graph").attr("width",650).attr("height",240).append("g").attr("transform","translate(30, 20)"),E=l.e().keys(["don","kat"])(a.data);b.domain(E[0].map((function(e,t){return t}))),m.domain([0,5*Math.ceil(a.max/5)]);var O=function(){return l.a(m).ticks(5).tickValues(k)};x.append("g").attr("class","grid").call(O().tickSize(-600).tickFormat("")),x.selectAll(".layer").data(E).enter().append("g").attr("class","layer").style("fill",(function(e,t){return["#f44e","#44fe"][t]})).selectAll("rect").data((function(e){return e})).enter().append("rect").attr("x",(function(e,t){return b(t)})).attr("y",(function(e){return m(e[1])})).attr("height",(function(e){return m(e[0])-m(e[1])})).attr("width",b.bandwidth),x.append("g").attr("class","axis-y").call(O())}(M(U,H))}catch(e){console.error(e),W(e.message)}}()}function J(){try{for(var e in U=function(e){var t,a=e.split(/(\r\n|\r|\n)/).map((function(e){return e.trim()})),r={title:"",subtitle:"",bpm:120,wave:"",offset:0,demoStart:0,genre:""},n={},o=[];for(t=0;t<a.length;t++){var s=a[t];if(""!==s){var i=p(s);if("header"===i.type&&"global"===i.scope)switch(i.name){case"TITLE":r.title=i.value;break;case"SUBTITLE":r.subtitle=i.value;break;case"BPM":r.bpm=parseFloat(i.value);break;case"WAVE":r.wave=i.value;break;case"OFFSET":r.offset=parseFloat(i.value);break;case"DEMOSTART":r.demoStart=parseFloat(i.value);break;case"GENRE":r.genre=i.value}else if("header"===i.type&&"course"===i.scope){if("COURSE"===i.name&&o.length){var l=v(r,o);n[l.course]=l,o=[]}o.push(i)}else"command"===i.type?o.push(i):"data"===i.type&&o.push(i)}}if(o.length){var c=v(r,o);n[c.course]=c}return{headers:r,courses:n}}(j.first().value),i()(".controls-diff .button").addClass("is-hidden"),U.courses)i()(".controls-diff .btn-diff-".concat(e)).removeClass("is-hidden");W("No error")}catch(e){console.error(e),W(e.message)}}function K(){""!==H&&(i()("#tja-preview").remove(),document.fonts.load('5px "Pixel 3x5"').then((function(){try{var e=P(U,H);e.id="tja-preview",i()(".page-preview").append(e),W("No error")}catch(e){console.error(e),W(e.message)}})))}D.on("click",(function(){J(),K()})),j.on("input",(function(){N.first().checked&&(J(),_())})),j.on("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="cppy"})),j.on("drop",(function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0],a=new FileReader;a.onload=function(e){var t=e.target.result,a=new Uint8Array(t),r=o.Buffer.from(a),n=f.a.detect(r),s=d.a.decode(r,n);j.first().value=s,H="",J(),_()},a.readAsArrayBuffer(t)})),i()(".controls-diff .button").on("click",(function(e){var t=i()(e.target).data("value");H=t,_()})),i()(".controls-page .button").on("click",(function(e){var t=i()(e.target).data("value");V=t,_()})),j.first().value&&J(),_()}});